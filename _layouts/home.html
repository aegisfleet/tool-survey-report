---
layout: default
---

<div class="home-container">
  <section class="home-hero">
    <div class="hero-image">
      <img src="{{ '/assets/images/default-ogp.png' | relative_url }}" alt="{{ site.title }}" class="ogp-image">
    </div>
    <div class="hero-content">
      <div class="hero-text">
        {{ content }}
      </div>
    </div>
  </section>

  <main class="home-content">

    <!-- ãƒ©ãƒ³ãƒ€ãƒ ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ— -->
    <section class="random-picks">
      <div class="picks-header">
        <div>
          <h2>ğŸ² ãŠã™ã™ã‚ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—</h2>
          <p class="picks-desc">ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã°ã‚ŒãŸ4ã¤ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ã”ç´¹ä»‹</p>
        </div>
        <button type="button" class="refresh-btn" id="refresh-picks" aria-label="åˆ¥ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
          </svg>
          ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        </button>
      </div>
      <div class="picks-grid" id="random-picks-grid">
        {%- assign all_reports = site.reports | sort: 'last_updated' | reverse -%}
        {%- for report in all_reports limit: 4 -%}
        <a href="{{ report.url | relative_url }}" class="pick-card" data-url="{{ report.url | relative_url }}"
          data-title="{{ report.tool_name | default: report.title }}" data-desc="{{ report.description }}">
          <span class="pick-title">{{ report.tool_name | default: report.title }}</span>
          <span class="pick-category clickable-category" data-category="{{ report.category | downcase }}" role="button"
            tabindex="0">{{ report.category }}</span>
          <div class="pick-meta">
            {%- if report.quick_summary.is_oss -%}
            <span class="pick-oss-badge">OSS</span>
            {%- elsif report.quick_summary.has_free_plan -%}
            <span class="pick-free-badge">ğŸ’š ç„¡æ–™ãƒ—ãƒ©ãƒ³ã‚ã‚Š</span>
            {%- endif -%}
            {%- if report.evaluation.score -%}
            <span class="pick-score">{{ report.evaluation.score }}ç‚¹</span>
            {%- endif -%}
          </div>
        </a>
        {%- endfor -%}
      </div>
    </section>

    <section class="reports-section">
      <div class="reports-header">
        <h2>æœ€æ–°ã®ãƒ¬ãƒãƒ¼ãƒˆ</h2>
        <div class="reports-controls">
          <div class="search-container">
            <input type="text" id="report-search" placeholder="ãƒ„ãƒ¼ãƒ«åã€èª¬æ˜ã€ã‚¿ã‚°ã§æ¤œç´¢..." class="search-input">
            <button type="button" class="search-clear" id="search-clear" aria-label="æ¤œç´¢ã‚’ã‚¯ãƒªã‚¢">Ã—</button>
          </div>

          <div class="filter-container">
            <select id="tag-filter" class="tag-filter">
              <option value="">ã™ã¹ã¦ã®ã‚¿ã‚°</option>
            </select>
            <button type="button" class="filter-clear" id="tag-filter-clear" aria-label="ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‚¯ãƒªã‚¢">Ã—</button>
          </div>
          <div class="filter-container">
            <select id="category-filter" class="category-filter">
              <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
              {%- assign all_categories = site.reports | map: 'category' | uniq | sort -%}
              {%- for category in all_categories -%}
              {%- if category and category != '' -%}
              <option value="{{ category | downcase }}">{{ category }}</option>
              {%- endif -%}
              {%- endfor -%}
            </select>
            <button type="button" class="filter-clear" id="category-filter-clear" aria-label="ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‚¯ãƒªã‚¢">Ã—</button>
          </div>
          <div class="sort-container">
            <select id="sort-select" class="sort-select">
              <option value="date-desc" selected>æ–°ã—ã„é †</option>
              <option value="date-asc">å¤ã„é †</option>
              <option value="title-asc">ãƒ„ãƒ¼ãƒ«åé †</option>
              <option value="score-desc">ç·åˆè©•ä¾¡é †</option>
              <option value="oss-free">OSSãƒ»ç„¡æ–™é †</option>
            </select>
          </div>
        </div>
      </div>

      <div class="reports-grid" id="reports-grid">
        {%- assign sorted_reports = site.reports | sort: 'last_updated' | reverse -%}
        {%- for report in sorted_reports -%}
        <article class="report-card" data-tags="{{ report.tags | join: ',' }}"
          data-title="{{ report.title | downcase }}" data-tool-name="{{ report.tool_name | downcase }}"
          data-description="{{ report.description | downcase }}"
          data-latest-highlight="{{ report.quick_summary.latest_highlight | downcase }}"
          data-date="{{ report.last_updated | date: '%Y-%m-%d' }}" data-category="{{ report.category | downcase }}"
          data-developer="{{ report.developer | downcase }}"
          data-is-oss="{{ report.quick_summary.is_oss | default: false }}"
          data-has-free-plan="{{ report.quick_summary.has_free_plan | default: false }}"
          data-score="{{ report.evaluation.score | default: 0 }}">

          <div class="report-card-header">
            <h3 class="report-title">
              <a href="{{ report.url | relative_url }}">{{ report.tool_name | default: report.title }}</a>
            </h3>
            <div class="report-header-meta">
              <time class="report-date" datetime="{{ report.last_updated | date: '%Y-%m-%d' }}">
                {{ report.last_updated | date: "%Yå¹´%mæœˆ%dæ—¥" }}
              </time>
              {%- if report.quick_summary.is_oss -%}
              <span class="card-oss-badge">OSS</span>
              {%- elsif report.quick_summary.has_free_plan -%}
              <span class="card-free-badge">ğŸ’š ç„¡æ–™ãƒ—ãƒ©ãƒ³ã‚ã‚Š</span>
              {%- endif -%}
              {%- if report.evaluation.score -%}
              <span class="card-score-badge">{{ report.evaluation.score }}ç‚¹</span>
              {%- endif -%}
            </div>
          </div>

          {% if report.description %}
          <p class="report-description">{{ report.description }}</p>
          {% endif %}

          {% if report.quick_summary.latest_highlight %}
          <div class="report-latest-highlight">
            <span class="highlight-label">æœ€æ–°æƒ…å ±</span>
            <p class="highlight-content">ğŸ“¢ {{ report.quick_summary.latest_highlight }}</p>
          </div>
          {% endif %}

          <div class="report-meta">
            {% if report.developer %}
            <span class="meta-item developer">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path
                  d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5z" />
                <path d="M3 3h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" />
              </svg>
              {{ report.developer }}
            </span>
            {% endif %}
            {% if report.category %}
            <span class="meta-item category clickable-category" data-category="{{ report.category | downcase }}"
              role="button" tabindex="0">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path
                  d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
              </svg>
              {{ report.category }}
            </span>
            {% endif %}
          </div>

          {%- if report.tags and report.tags.size > 0 -%}
          <div class="report-tags">
            {%- for tag in report.tags -%}
            <span class="tag" data-tag="{{ tag }}">{{ tag }}</span>
            {%- endfor -%}
          </div>
          {%- endif -%}

          <div class="report-card-footer">
            <a href="{{ report.url | relative_url }}" class="read-more">ç¶šãã‚’èª­ã‚€ â†’</a>
          </div>
        </article>
        {% endfor %}
      </div>

      {% if site.reports.size == 0 %}
      <div class="no-reports">
        <p>ã¾ã ãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      </div>
      {% endif %}

      <div class="no-results" id="no-results" style="display: none;">
        <p>æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
      </div>
    </section>

    <section class="stats-section">
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-number">{{ site.reports.size }}</span>
          <span class="stat-label">ç·ãƒ¬ãƒãƒ¼ãƒˆæ•°</span>
        </div>
        <div class="stat-item">
          {% assign unique_tags = site.reports | map: 'tags' | join: ',' | split: ',' | uniq | size %}
          <span class="stat-number">{{ unique_tags }}</span>
          <span class="stat-label">ã‚¿ã‚°æ•°</span>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('report-search');
    const searchClear = document.getElementById('search-clear');
    const tagFilter = document.getElementById('tag-filter');
    const tagFilterClear = document.getElementById('tag-filter-clear');
    const categoryFilter = document.getElementById('category-filter');
    const categoryFilterClear = document.getElementById('category-filter-clear');
    const sortSelect = document.getElementById('sort-select');
    const reportsGrid = document.getElementById('reports-grid');
    const noResults = document.getElementById('no-results');
    const reportCards = Array.from(document.querySelectorAll('.report-card'));

    // ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã‚’sessionStorageã«ä¿å­˜ã™ã‚‹ã‚­ãƒ¼
    const FILTER_STATE_KEY = 'homeFilterState';

    // ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
    function saveFilterState() {
      const state = {
        search: searchInput.value,
        tag: tagFilter.value,
        category: categoryFilter.value,
        sort: sortSelect.value
      };
      sessionStorage.setItem(FILTER_STATE_KEY, JSON.stringify(state));
    }

    // ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹é–¢æ•°
    function restoreFilterState() {
      const savedState = sessionStorage.getItem(FILTER_STATE_KEY);
      if (savedState) {
        try {
          const state = JSON.parse(savedState);
          if (state.search) searchInput.value = state.search;
          if (state.tag) tagFilter.value = state.tag;
          if (state.category) categoryFilter.value = state.category;
          if (state.sort) sortSelect.value = state.sort;
          return true;
        } catch (e) {
          console.warn('Failed to restore filter state:', e);
        }
      }
      return false;
    }

    // Populate tag filter options
    const allTags = new Set();
    reportCards.forEach(card => {
      const tags = card.dataset.tags.split(',').filter(tag => tag.trim());
      tags.forEach(tag => allTags.add(tag.trim()));
    });

    Array.from(allTags).sort().forEach(tag => {
      const option = document.createElement('option');
      option.value = tag;
      option.textContent = tag;
      tagFilter.appendChild(option);
    });

    // Update tag visual states
    function updateTagStates() {
      const selectedTag = tagFilter.value;
      const allTagElements = document.querySelectorAll('.tag');

      allTagElements.forEach(tagElement => {
        const tagValue = tagElement.dataset.tag;
        if (tagValue === selectedTag && selectedTag !== '') {
          tagElement.classList.add('active');
        } else {
          tagElement.classList.remove('active');
        }
      });
    }

    // Update category visual states
    function updateCategoryStates() {
      const selectedCategory = categoryFilter.value;
      const allCategoryElements = document.querySelectorAll('.clickable-category');

      allCategoryElements.forEach(el => {
        const categoryValue = el.dataset.category;
        if (categoryValue === selectedCategory && selectedCategory !== '') {
          el.classList.add('active');
        } else {
          el.classList.remove('active');
        }
      });
    }

    // Filter and sort function
    window.filterAndSort = function (shouldSave = true) {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const selectedTag = tagFilter.value;
      const selectedCategory = categoryFilter.value;
      const sortBy = sortSelect.value;

      let filteredCards = reportCards.filter(card => {
        const matchesSearch = !searchTerm ||
          (card.dataset.toolName && card.dataset.toolName.includes(searchTerm)) ||
          (card.dataset.description && card.dataset.description.includes(searchTerm)) ||
          (card.dataset.latestHighlight && card.dataset.latestHighlight.includes(searchTerm)) ||
          (card.dataset.developer && card.dataset.developer.includes(searchTerm)) ||
          (card.dataset.tags && card.dataset.tags.toLowerCase().includes(searchTerm));
        const matchesTag = !selectedTag || card.dataset.tags.split(',').map(t => t.trim()).includes(selectedTag);
        const matchesCategory = !selectedCategory || card.dataset.category === selectedCategory;
        return matchesSearch && matchesTag && matchesCategory;
      });

      // Sort cards
      filteredCards.sort((a, b) => {
        switch (sortBy) {
          case 'date-desc':
            return new Date(b.dataset.date) - new Date(a.dataset.date);
          case 'date-asc':
            return new Date(a.dataset.date) - new Date(b.dataset.date);
          case 'title-asc':
            return a.dataset.toolName.localeCompare(b.dataset.toolName);
          case 'score-desc':
            // ã‚¹ã‚³ã‚¢ãŒé«˜ã„é †ã§ã‚½ãƒ¼ãƒˆï¼ˆã‚¹ã‚³ã‚¢ãŒãªã„å ´åˆã¯0ã¨ã—ã¦æ‰±ã†ï¼‰
            const scoreA = parseFloat(a.dataset.score) || 0;
            const scoreB = parseFloat(b.dataset.score) || 0;
            return scoreB - scoreA;
          case 'oss-free':
            // OSS > ç„¡æ–™ãƒ—ãƒ©ãƒ³ > ãã®ä»–ã®é †ã§ã‚½ãƒ¼ãƒˆ
            const getPriority = (card) => {
              if (card.dataset.isOss === 'true') return 2;
              if (card.dataset.hasFreePlan === 'true') return 1;
              return 0;
            };
            const priorityDiff = getPriority(b) - getPriority(a);
            // åŒã˜å„ªå…ˆåº¦ã®å ´åˆã¯ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆ
            if (priorityDiff !== 0) return priorityDiff;
            return (parseFloat(b.dataset.score) || 0) - (parseFloat(a.dataset.score) || 0);
          default:
            return 0;
        }
      });

      // Hide all cards first
      reportCards.forEach(card => card.style.display = 'none');

      // Show filtered and sorted cards
      if (filteredCards.length > 0) {
        filteredCards.forEach(card => {
          card.style.display = 'block';
          reportsGrid.appendChild(card); // Re-append to maintain order
        });
        noResults.style.display = 'none';
      } else {
        noResults.style.display = 'block';
      }

      // Update visual states immediately
      updateTagStates();
      updateCategoryStates();

      // ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã‚’ä¿å­˜
      if (shouldSave) {
        saveFilterState();
      }

      // URLã‚’æ›´æ–°ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ã®çŠ¶æ…‹ã‚’åæ˜ ï¼‰
      if (shouldSave) {
        updateURL(selectedCategory);
      }
    }

    // URLã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ã®çŠ¶æ…‹ã‚’åæ˜ ï¼‰
    const siteName = '{{ site.title }}';
    function updateURL(category) {
      const url = new URL(window.location);

      if (category) {
        // ã‚«ãƒ†ã‚´ãƒªåã‚’å…ƒã®è¡¨è¨˜ã§å–å¾—ï¼ˆã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ï¼‰
        const categoryOption = categoryFilter.querySelector(`option[value="${category}"]`);
        const originalCategoryName = categoryOption ? categoryOption.textContent : category;
        url.searchParams.set('category', originalCategoryName);

        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
        document.title = `${originalCategoryName} | ${siteName}`;
      } else {
        url.searchParams.delete('category');

        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚µã‚¤ãƒˆåã«æˆ»ã™
        document.title = siteName;
      }

      // ã‚¿ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å‰Šé™¤ï¼ˆã‚«ãƒ†ã‚´ãƒªã¨ä½µç”¨ã—ãªã„è¨­è¨ˆï¼‰
      url.searchParams.delete('tag');

      // URLã‚’æ›´æ–°ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å±¥æ­´ã«ã¯replaceã§ä¸Šæ›¸ãï¼‰
      history.replaceState(null, '', url.toString());
    }

    // Event listeners
    searchInput.addEventListener('input', function () { filterAndSort(); });
    tagFilter.addEventListener('change', function () { filterAndSort(); });
    categoryFilter.addEventListener('change', function () { filterAndSort(); });
    sortSelect.addEventListener('change', function () { filterAndSort(); });

    searchClear.addEventListener('click', function () {
      searchInput.value = '';
      filterAndSort();
    });

    tagFilterClear.addEventListener('click', function () {
      tagFilter.value = '';
      filterAndSort();
    });

    categoryFilterClear.addEventListener('click', function () {
      categoryFilter.value = '';
      filterAndSort();
    });

    // Handle URL parameters for tag/category filtering
    const urlParams = new URLSearchParams(window.location.search);
    const tagParam = urlParams.get('tag');
    const categoryParam = urlParams.get('category');

    if (tagParam || categoryParam) {
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯å„ªå…ˆ
      if (tagParam) tagFilter.value = tagParam;
      if (categoryParam) {
        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å…ƒã®ã‚«ãƒ†ã‚´ãƒªåã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€
        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å€¤ï¼ˆå°æ–‡å­—ï¼‰ã«å¤‰æ›ã—ã¦è¨­å®š
        categoryFilter.value = categoryParam.toLowerCase();
      }
      filterAndSort();
    } else {
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯sessionStorageã‹ã‚‰å¾©å…ƒã‚’è©¦ã¿ã‚‹
      const restored = restoreFilterState();
      if (restored) {
        filterAndSort(false); // å¾©å…ƒæ™‚ã¯ä¿å­˜ã—ãªã„
      } else {
        // åˆæœŸçŠ¶æ…‹ã§ã‚‚çŠ¶æ…‹ã‚’æ›´æ–°
        updateTagStates();
        updateCategoryStates();
      }
    }

    // ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰æ™‚ã«ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã‚’å¾©å…ƒ
    window.addEventListener('pageshow', function (event) {
      // bfcacheã‹ã‚‰å¾©å…ƒã•ã‚ŒãŸå ´åˆï¼ˆevent.persisted === trueï¼‰
      if (event.persisted) {
        const restored = restoreFilterState();
        if (restored) {
          filterAndSort(false); // å¾©å…ƒæ™‚ã¯ä¿å­˜ã—ãªã„
        }
      }
    });

    // Tag/Category click functionality
    document.addEventListener('click', function (e) {
      if (e.target.classList.contains('tag')) {
        e.preventDefault(); // ã‚¿ãƒƒãƒ—æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²ã
        handleTagClick(e.target);
      } else if (e.target.closest('.clickable-category')) {
        const categoryElement = e.target.closest('.clickable-category');
        e.preventDefault();
        e.stopPropagation(); // pick-cardã®ãƒªãƒ³ã‚¯é·ç§»ã‚’é˜²ã
        handleCategoryClick(categoryElement);
      }
    });

    // ã‚«ãƒ†ã‚´ãƒªã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    function handleCategoryClick(categoryElement) {
      const categoryValue = categoryElement.dataset.category;

      if (categoryFilter.value === categoryValue) {
        categoryFilter.value = '';
      } else {
        categoryFilter.value = categoryValue;
      }

      filterAndSort();
      categoryElement.blur();
    }

    // ã‚¿ã‚°ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ã‚’å…±é€šåŒ–
    function handleTagClick(tagElement) {
      const tagValue = tagElement.dataset.tag;

      // åŒã˜ã‚¿ã‚°ãŒæ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ•ã‚£ãƒ«ã‚¿ã‚’è§£é™¤
      if (tagFilter.value === tagValue) {
        tagFilter.value = '';
      } else {
        tagFilter.value = tagValue;
      }

      filterAndSort();

      // ã‚¿ãƒƒãƒ—å¾Œã™ãã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œï¼‰
      tagElement.blur();

      // ä¸€æ™‚çš„ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦å†é©ç”¨ï¼ˆè¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
      setTimeout(() => {
        updateTagStates();
      }, 50);
    }

    // ãƒ©ãƒ³ãƒ€ãƒ ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ã‚·ãƒ£ãƒƒãƒ•ãƒ«å‡¦ç†
    function shuffleRandomPicks() {
      const picksGrid = document.getElementById('random-picks-grid');
      if (!picksGrid) return;

      const pickCards = Array.from(picksGrid.querySelectorAll('.pick-card'));
      const allReportCards = Array.from(document.querySelectorAll('.report-card'));

      if (allReportCards.length <= 4) return;

      // ã™ã¹ã¦ã®ãƒ¬ãƒãƒ¼ãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«4ã¤é¸æŠï¼ˆã‚¹ã‚³ã‚¢ã¨ç„¡æ–™ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚‚å–å¾—ï¼‰
      const shuffled = allReportCards
        .map(card => ({
          url: card.querySelector('a')?.href || '#',
          title: card.querySelector('.report-title a')?.textContent?.trim() || 'Unknown',
          category: card.querySelector('.meta-item.category')?.textContent?.trim() || '',
          score: card.querySelector('.card-score-badge')?.textContent?.trim() || '',
          hasFreePlan: !!card.querySelector('.card-free-badge'),
          isOss: card.dataset.isOss === 'true'
        }))
        .sort(() => Math.random() - 0.5)
        .slice(0, 4);

      // ãƒ”ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
      pickCards.forEach((card, index) => {
        if (shuffled[index]) {
          card.href = shuffled[index].url;
          card.querySelector('.pick-title').textContent = shuffled[index].title;
          const pc = card.querySelector('.pick-category');
          pc.textContent = shuffled[index].category;
          pc.dataset.category = (shuffled[index].category || '').toLowerCase();

          // ãƒ¡ã‚¿ã‚³ãƒ³ãƒ†ãƒŠã‚’å–å¾—ã¾ãŸã¯ä½œæˆ
          let metaContainer = card.querySelector('.pick-meta');
          if (!metaContainer) {
            metaContainer = document.createElement('div');
            metaContainer.className = 'pick-meta';
            card.appendChild(metaContainer);
          }

          // ãƒ¡ã‚¿ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ—¦ã‚¯ãƒªã‚¢ã—ã¦å†æç”»
          metaContainer.innerHTML = '';

          // OSS ãƒãƒƒã‚¸ã‚’æœ€å„ªå…ˆ
          if (shuffled[index].isOss) {
            const ossBadge = document.createElement('span');
            ossBadge.className = 'pick-oss-badge';
            ossBadge.textContent = 'OSS';
            metaContainer.appendChild(ossBadge);
          }
          // OSSã§ãªã„å ´åˆã«ã®ã¿ç„¡æ–™ãƒ—ãƒ©ãƒ³ãƒãƒƒã‚¸
          else if (shuffled[index].hasFreePlan) {
            const freeBadge = document.createElement('span');
            freeBadge.className = 'pick-free-badge';
            freeBadge.textContent = 'ğŸ’š ç„¡æ–™ãƒ—ãƒ©ãƒ³ã‚ã‚Š';
            metaContainer.appendChild(freeBadge);
          }

          // ã‚¹ã‚³ã‚¢ãƒãƒƒã‚¸ã‚’è¿½åŠ 
          if (shuffled[index].score) {
            const scoreEl = document.createElement('span');
            scoreEl.className = 'pick-score';
            scoreEl.textContent = shuffled[index].score;
            metaContainer.appendChild(scoreEl);
          }
        }
      });
      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œã«ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã«åˆã‚ã›ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡¨ç¤ºã‚’æ›´æ–°
      updateCategoryStates();
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    shuffleRandomPicks();

    // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    const refreshBtn = document.getElementById('refresh-picks');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', function () {
        shuffleRandomPicks();
        // ãƒœã‚¿ãƒ³ã‚’ä¸€ç¬å›è»¢ã•ã›ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        this.style.transform = 'scale(1.1) rotate(180deg)';
        setTimeout(() => {
          this.style.transform = '';
        }, 300);
      });
    }
  });
</script>