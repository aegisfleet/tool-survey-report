<nav class="main-navigation" role="navigation" aria-label="メインナビゲーション">
  <button class="nav-toggle" aria-controls="nav-menu" aria-expanded="false" aria-label="メニューを開く">
    <span class="nav-toggle-icon">
      <span></span>
      <span></span>
      <span></span>
    </span>
  </button>

  <ul class="nav-menu" id="nav-menu">
    <li class="nav-item">
      <a href="{{ '/' | relative_url }}" class="nav-link {% if page.url == '/' %}current{% endif %}">
        ホーム
      </a>
    </li>

    <li class="nav-item nav-item-dropdown">
      <button class="nav-link nav-dropdown-toggle" aria-expanded="false" aria-haspopup="true">
        カテゴリ
        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 9l6 6 6-6" />
        </svg>
      </button>
      <div class="nav-dropdown" role="menu">
        <div class="nav-dropdown-header">
          <span>カテゴリを選択</span>
          <a href="{{ '/categories/' | relative_url }}">すべて見る</a>
        </div>
        {% assign all_categories = site.reports | map: 'category' | uniq | sort %}
        {% for category in all_categories %}
        {% if category and category != '' %}
        {% assign category_reports = site.reports | where: "category", category %}
        <a href="{{ '/' | relative_url }}?category={{ category | url_encode }}" class="nav-dropdown-item"
          role="menuitem">
          {{ category }}
          <span class="dropdown-count">{{ category_reports.size }}</span>
        </a>
        {% endif %}
        {% endfor %}
      </div>
    </li>

    <li class="nav-item">
      <a href="{{ '/tags/' | relative_url }}" class="nav-link {% if page.url contains '/tags/' %}current{% endif %}">
        タグ一覧
      </a>
    </li>


    {%- if site.data.navigation.main_links -%}
    {%- for link in site.data.navigation.main_links -%}
    <li class="nav-item">
      <a href="{{ link.url | relative_url }}" class="nav-link {% if page.url == link.url %}current{% endif %}">
        {{ link.title }}
      </a>
    </li>
    {%- endfor -%}
    {%- endif -%}
  </ul>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Category dropdown toggle for mobile
    const dropdownToggle = document.querySelector('.nav-dropdown-toggle');
    const dropdown = document.querySelector('.nav-dropdown');

    if (dropdownToggle && dropdown) {
      dropdownToggle.addEventListener('click', function (e) {
        e.preventDefault();
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !isExpanded);
        dropdown.classList.toggle('active');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function (e) {
        if (!dropdownToggle.contains(e.target) && !dropdown.contains(e.target)) {
          dropdownToggle.setAttribute('aria-expanded', 'false');
          dropdown.classList.remove('active');
        }
      });
    }
  });
</script>